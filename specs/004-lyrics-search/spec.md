# Feature Specification: 歌詞搜尋功能

**Feature Branch**: `004-lyrics-search`  
**Created**: 2025-12-08  
**Status**: Draft  
**Input**: User description: "做一個搜尋歌詞的網站，而搜尋出來的結果要有歌名跟歌手名稱，假如有丟入歌詞當作搜尋條件的話則會在搜尋結果中顯示對應的歌詞片段，並且高亮那個歌詞片段，而點擊後會進去歌曲本身的詳細頁面。在這個階段先作搜尋功能即可！"

## Clarifications

### Session 2025-12-13

- Q: 歌詞片段顯示的上下文行數？ → A: 固定 3 行（匹配行 + 前後各 1 行）
- Q: 搜尋匹配邏輯的精確度？ → A: 混合模式（歌名/歌手精確匹配，歌詞部分匹配）
- Q: 大量搜尋結果的處理策略？ → A: 分頁按鈕（每頁 20 筆，底部顯示頁碼）
- Q: 防抖延遲時間的精確值？ → A: 400ms
- Q: 高亮顯示的視覺樣式？ → A: 黃色背景 + 粗體文字

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 基本關鍵字搜尋 (Priority: P1)

使用者可以在搜尋框中輸入關鍵字（歌名或歌手名稱），系統會顯示所有符合條件的歌曲列表，包含歌名和歌手名稱。

**Why this priority**: 這是最核心的搜尋功能，不依賴其他功能即可獨立運作，提供基本的歌曲查找能力。

**Independent Test**: 使用者輸入「周杰倫」，系統返回所有歌手名稱包含「周杰倫」的歌曲列表，每個結果顯示歌名和歌手名稱。

**Acceptance Scenarios**:

1. **Given** 使用者在首頁，**When** 在搜尋框輸入「稻香」並按下搜尋，**Then** 系統顯示所有歌名完全匹配「稻香」的歌曲列表
2. **Given** 使用者在首頁，**When** 在搜尋框輸入「周杰倫」並按下搜尋，**Then** 系統顯示所有歌手名稱完全匹配「周杰倫」的歌曲列表
3. **Given** 使用者在首頁，**When** 在搜尋框輸入不存在的關鍵字「xyzabc123」，**Then** 系統顯示「查無結果」訊息
4. **Given** 搜尋結果已顯示，**When** 使用者修改搜尋框內容並再次搜尋，**Then** 系統更新搜尋結果
5. **Given** 搜尋返回超過 20 筆結果，**When** 使用者檢視結果，**Then** 系統顯示前 20 筆並在底部提供分頁按鈕

---

### User Story 2 - 歌詞片段搜尋與高亮 (Priority: P2)

使用者輸入歌詞內容作為搜尋條件時，系統會在搜尋結果中顯示匹配的歌詞片段，並高亮顯示匹配的文字。

**Why this priority**: 這是歌詞搜尋網站的核心差異化功能，允許使用者透過記得的歌詞片段找到歌曲，但需要基本搜尋功能（P1）作為基礎。

**Independent Test**: 使用者輸入「天青色等煙雨」，系統返回包含此歌詞的歌曲，並在結果中顯示該歌詞片段，「天青色等煙雨」以高亮顯示。

**Acceptance Scenarios**:

1. **Given** 使用者在首頁，**When** 在搜尋框輸入歌詞內容，**Then** 系統顯示包含此歌詞的歌曲（部分匹配），並在結果中顯示該歌詞片段（匹配行 + 前後各 1 行，共 3 行）
2. **Given** 搜尋結果顯示歌詞片段，**When** 使用者檢視結果，**Then** 匹配的關鍵字以黃色背景加粗體文字高亮顯示
3. **Given** 使用者輸入部分歌詞，**When** 系統找到多首歌曲，**Then** 每個結果都顯示包含關鍵字的歌詞片段（3 行上下文）
4. **Given** 使用者輸入歌詞關鍵字，**When** 一首歌曲中有多處匹配，**Then** 系統優先顯示第一處匹配的片段
5. **Given** 歌詞搜尋返回超過 20 筆結果，**When** 使用者查看，**Then** 系統顯示分頁控制，每頁 20 筆結果

---

### User Story 3 - 點擊進入歌曲詳細頁面 (Priority: P3)

使用者可以點擊搜尋結果中的任一歌曲，進入該歌曲的詳細頁面。

**Why this priority**: 這是搜尋功能的延伸，提供使用者查看完整歌曲資訊的入口，但本階段重點在搜尋功能本身。

**Independent Test**: 使用者在搜尋結果頁面點擊任一歌曲項目，瀏覽器導航到該歌曲的詳細頁面（URL 包含歌曲 ID）。

**Acceptance Scenarios**:

1. **Given** 搜尋結果已顯示多首歌曲，**When** 使用者點擊其中一首歌曲，**Then** 瀏覽器導航到該歌曲的詳細頁面
2. **Given** 使用者在歌曲詳細頁面，**When** 使用者點擊返回按鈕，**Then** 使用者返回搜尋結果頁面，並保持之前的搜尋條件
3. **Given** 搜尋結果已顯示，**When** 使用者將滑鼠移至歌曲項目上，**Then** 該項目顯示 hover 效果，提示可點擊

---

### Edge Cases

- 使用者輸入空白字串或只有空格時，系統應顯示提示訊息「請輸入搜尋關鍵字」，不執行搜尋
- 使用者輸入超長字串（超過 200 字元）時，系統應限制輸入長度或顯示警告
- 搜尋關鍵字包含特殊符號（如 `*`, `?`, `%`）時，系統應正確處理或跳脫特殊字元
- 網路請求失敗或逾時時，系統應顯示友善的錯誤訊息「搜尋失敗，請稍後再試」
- 搜尋返回大量結果時，系統應實作分頁機制（每頁 20 筆，底部顯示頁碼），避免效能問題
- 使用者快速連續輸入並搜尋時，系統應使用防抖機制（400ms），避免過多請求

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系統 MUST 提供搜尋輸入框，接受使用者輸入的關鍵字（歌名、歌手名稱或歌詞）
- **FR-002**: 系統 MUST 提供搜尋按鈕或支援 Enter 鍵觸發搜尋
- **FR-003**: 系統 MUST 在使用者提交搜尋後，顯示所有匹配的歌曲列表
- **FR-004**: 搜尋結果中的每個項目 MUST 顯示歌名和歌手名稱
- **FR-005**: 搜尋歌名和歌手名稱時 MUST 使用精確匹配（完全一致），搜尋歌詞時 MUST 使用部分匹配（包含即符合）
- **FR-006**: 當搜尋關鍵字匹配歌詞內容時，系統 MUST 在搜尋結果中顯示對應的歌詞片段（固定 3 行：匹配行 + 前後各 1 行）
- **FR-007**: 系統 MUST 在歌詞片段中高亮顯示匹配的關鍵字，使用黃色背景加粗體文字樣式
- **FR-008**: 搜尋結果中的每個歌曲項目 MUST 可點擊，點擊後導航到該歌曲的詳細頁面
- **FR-009**: 系統 MUST 在搜尋期間顯示載入指示器（loading spinner 或骨架屏）
- **FR-010**: 當搜尋無結果時，系統 MUST 顯示「查無結果」訊息
- **FR-011**: 系統 MUST 驗證搜尋輸入，拒絕空白或只有空格的搜尋請求，並顯示提示訊息
- **FR-012**: 系統 MUST 實作搜尋輸入的防抖機制（固定 400ms），避免過度頻繁的 API 請求
- **FR-013**: 系統 MUST 實作分頁機制，每頁顯示 20 筆結果，並在底部提供頁碼導航
- **FR-014**: 搜尋結果頁面 MUST 支援返回上一頁的功能，並保持搜尋狀態和當前頁碼

### Key Entities

- **歌曲 (Song)**: 代表一首歌曲，包含 ID、歌名、歌手名稱、完整歌詞內容
- **搜尋結果項目 (SearchResultItem)**: 代表搜尋結果中的一個項目，包含歌曲基本資訊（ID、歌名、歌手）以及匹配的歌詞片段（如果搜尋條件匹配歌詞）
- **搜尋查詢 (SearchQuery)**: 代表使用者的搜尋請求，包含關鍵字、分頁參數（如果需要）

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 使用者可以在 3 秒內完成搜尋操作（從輸入到看到結果）
- **SC-002**: 搜尋結果顯示時，首次內容繪製 (FCP) < 1.5 秒，最大內容繪製 (LCP) < 2.5 秒
- **SC-003**: 90% 的使用者能在首次嘗試中成功找到目標歌曲
- **SC-004**: 歌詞片段的高亮顯示在視覺上明顯可見，使用者無需額外思考即可識別匹配文字
- **SC-005**: 系統處理 100 筆搜尋結果時，頁面渲染時間 < 500ms，滾動流暢度 60fps
- **SC-006**: 搜尋功能支援至少 50 位使用者同時進行搜尋操作，回應時間不超過 3 秒
- **SC-007**: 錯誤情境（無結果、網路錯誤）下，使用者看到清晰的正體中文錯誤訊息並知道如何繼續操作
