# Implementation Plan: æ­Œè©æœå°‹åŠŸèƒ½

**Branch**: `004-lyrics-search` | **Date**: 2025-12-13 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/004-lyrics-search/spec.md`

**Note**: This template is filled in by the `/speckit.plan` command. See `.specify/templates/commands/plan.md` for the execution workflow.

## Summary

å»ºç«‹æ­Œè©æœå°‹ç¶²ç«™çš„æ ¸å¿ƒæœå°‹åŠŸèƒ½ï¼Œæ”¯æ´ä»¥æ­Œåã€æ­Œæ‰‹åç¨±æˆ–æ­Œè©å…§å®¹é€²è¡Œæœå°‹ã€‚æœå°‹çµæœé¡¯ç¤ºæ­Œæ›²åŸºæœ¬è³‡è¨Šï¼ˆæ­Œåã€æ­Œæ‰‹ï¼‰ï¼Œç•¶æœå°‹æ¢ä»¶åŒ¹é…æ­Œè©æ™‚ï¼Œé¡¯ç¤ºå°æ‡‰æ­Œè©ç‰‡æ®µä¸¦é«˜äº®åŒ¹é…æ–‡å­—ã€‚ä½¿ç”¨è€…å¯é»æ“Šçµæœé€²å…¥æ­Œæ›²è©³ç´°é é¢ã€‚

**æŠ€è¡“ç­–ç•¥**ï¼šæ¡ç”¨ Vue 3 + TypeScript + Tailwind CSS v4 å»ºæ§‹å‰ç«¯å–®é æ‡‰ç”¨ï¼Œä½¿ç”¨ Feature-Based æ¶æ§‹çµ„ç¹”ç¨‹å¼ç¢¼ã€‚**è³‡æ–™ä¾†æºä½¿ç”¨ Google Sheetsï¼ˆæ¬„ä½ï¼šid, artist, title, lyricsï¼‰ï¼Œé€é Google Apps Script éƒ¨ç½²ç‚º Web API**ã€‚æœå°‹åŒ¹é…æ¡ç”¨æ··åˆæ¨¡å¼ï¼ˆæ­Œå/æ­Œæ‰‹ç²¾ç¢ºåŒ¹é…ï¼Œæ­Œè©éƒ¨åˆ†åŒ¹é…ï¼‰ï¼Œæ­Œè©ç‰‡æ®µå›ºå®šé¡¯ç¤º 3 è¡Œï¼ˆåŒ¹é…è¡Œ + å‰å¾Œå„ 1 è¡Œï¼‰ï¼Œé«˜äº®æ¨£å¼ç‚ºé»ƒè‰²èƒŒæ™¯åŠ ç²—é«”ã€‚å¯¦ä½œåˆ†é æ©Ÿåˆ¶ï¼ˆæ¯é  20 ç­†ï¼‰å’Œé˜²æŠ–æ©Ÿåˆ¶ï¼ˆ400msï¼‰ä»¥å„ªåŒ–æ•ˆèƒ½ã€‚

## Technical Context

**Language/Version**: TypeScript 5.9+ï¼ˆstrict mode å•Ÿç”¨ï¼‰
**Primary Dependencies**: Vue 3.5.24, Vite (Rolldown 7.2.5), Tailwind CSS v4, VueUse, Vue Router
**Storage**: Google Sheetsï¼ˆæ¬„ä½ï¼šid, artist, title, lyricsï¼‰ï¼Œé€é Google Apps Script Web App æä¾› API
**Testing**: Playwright (E2E), Vitest (å–®å…ƒæ¸¬è©¦)
**Target Platform**: ç¾ä»£ç€è¦½å™¨ï¼ˆChrome/Firefox/Safari æœ€æ–°ç‰ˆæœ¬ï¼‰ï¼ŒéŸ¿æ‡‰å¼è¨­è¨ˆæ”¯æ´æ¡Œé¢å’Œè¡Œå‹•è£ç½®
**Project Type**: å–®é æ‡‰ç”¨ï¼ˆSPAï¼‰ï¼Œæ¡ç”¨ Feature-Based æ¶æ§‹ï¼Œå¾Œç«¯ä½¿ç”¨ Google Apps Script
**Performance Goals**: FCP < 1.5s, LCP < 2.5s, 100 ç­†çµæœæ¸²æŸ“ < 500ms, 60fps æ»¾å‹•æµæš¢åº¦
**Constraints**: é˜²æŠ–å»¶é² 400ms, æ¯é  20 ç­†çµæœ, æ­Œè©ç‰‡æ®µå›ºå®š 3 è¡Œ, ä¸»å¥—ä»¶ < 200KB (gzip)
**Scale/Scope**: åˆæœŸæ”¯æ´ 50 ä½åŒæ™‚ä½¿ç”¨è€…ï¼Œæœå°‹å›æ‡‰æ™‚é–“ < 3 ç§’

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### âœ… I. æ¸¬è©¦å„ªå…ˆ (Test-First)
- [x] E2E æ¸¬è©¦å°‡ä½¿ç”¨ Playwrightï¼Œæ¶µè“‹æ‰€æœ‰ä¸‰å€‹ä½¿ç”¨è€…æ•…äº‹çš„é©—æ”¶å ´æ™¯
- [x] å–®å…ƒæ¸¬è©¦å°‡ä½¿ç”¨ Vitestï¼Œæ¸¬è©¦æœå°‹é‚è¼¯ã€é«˜äº®é‚è¼¯ã€åˆ†é é‚è¼¯ç­‰ç¨ç«‹å‡½å¼
- [x] éµå¾ª Red-Green-Refactor å¾ªç’°ï¼šå…ˆæ’°å¯«å¤±æ•—æ¸¬è©¦ï¼Œå†å¯¦ä½œåŠŸèƒ½
- [x] æ¸¬è©¦å®Œæˆå®šç¾©ï¼šæ‰€æœ‰æ¸¬è©¦å¾ç´…ç‡ˆ ğŸ”´ è®Šç‚ºç¶ ç‡ˆ ğŸŸ¢

### âœ… II. ç¨‹å¼ç¢¼å“è³ª
- [x] ä½¿ç”¨ TypeScript 5.9+ strict mode
- [x] éµå¾ª camelCaseï¼ˆè®Šæ•¸/å‡½å¼ï¼‰å’Œ PascalCaseï¼ˆå…ƒä»¶ï¼‰å‘½åè¦ç¯„
- [x] ç¨‹å¼ç¢¼è¨»è§£ä½¿ç”¨æ­£é«”ä¸­æ–‡ï¼Œè§£é‡‹ã€Œç‚ºä»€éº¼ã€è€Œéã€Œæ˜¯ä»€éº¼ã€
- [x] å–®ä¸€å‡½å¼ < 50 è¡Œï¼Œåœˆè¤‡é›œåº¦ < 10
- [x] é€šé OxLint æª¢æŸ¥ï¼ˆé›¶éŒ¯èª¤ã€é›¶è­¦å‘Šï¼‰

### âœ… III. ä½¿ç”¨è€…é«”é©—ä¸€è‡´æ€§
- [x] æ‰€æœ‰ UI æ–‡å­—ä½¿ç”¨æ­£é«”ä¸­æ–‡
- [x] éŒ¯èª¤è¨Šæ¯æ¸…æ™°å‹å–„ï¼ˆã€Œè«‹è¼¸å…¥æœå°‹é—œéµå­—ã€ã€ã€ŒæŸ¥ç„¡çµæœã€ã€ã€Œæœå°‹å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€ï¼‰
- [x] æä¾›è¼‰å…¥æŒ‡ç¤ºå™¨ï¼ˆloading spinner æˆ–éª¨æ¶å±ï¼‰
- [x] æ‰€æœ‰äº’å‹•å…ƒç´ æä¾›è¦–è¦ºå›é¥‹ï¼ˆhoverã€active ç‹€æ…‹ï¼‰
- [x] éŸ¿æ‡‰å¼è¨­è¨ˆæ”¯æ´æ¡Œé¢å’Œè¡Œå‹•è£ç½®

### âœ… IV. æ•ˆèƒ½è¦æ±‚
- [x] FCP < 1.5 ç§’ï¼ˆä½¿ç”¨ Vite å„ªåŒ–å»ºæ§‹ï¼‰
- [x] LCP < 2.5 ç§’ï¼ˆå„ªåŒ–é¦–å±è¼‰å…¥ï¼‰
- [x] 100 ç­†çµæœæ¸²æŸ“ < 500msï¼ˆä½¿ç”¨è™›æ“¬åŒ–æˆ–åˆ†é ï¼‰
- [x] 60fps æ»¾å‹•æµæš¢åº¦ï¼ˆé¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ï¼‰
- [x] ä¸»å¥—ä»¶ < 200KB gzipï¼ˆæŒ‰éœ€è¼‰å…¥ã€Tree Shakingï¼‰

### âœ… V. åœ‹éš›åŒ–èˆ‡èªç³»è¦ç¯„
- [x] å°ˆæ¡ˆæ–‡ä»¶ä½¿ç”¨æ­£é«”ä¸­æ–‡
- [x] ç¨‹å¼ç¢¼è®Šæ•¸/å‡½å¼/é¡åˆ¥ä½¿ç”¨è‹±æ–‡
- [x] ç¨‹å¼ç¢¼è¨»è§£ä½¿ç”¨æ­£é«”ä¸­æ–‡
- [x] UI æ–‡å­—å’ŒéŒ¯èª¤è¨Šæ¯ä½¿ç”¨æ­£é«”ä¸­æ–‡

### âœ… VI. Feature-Based æ¶æ§‹
- [x] æ¡ç”¨ Feature-Based è³‡æ–™å¤¾çµæ§‹ï¼ˆ`src/features/search/`ï¼‰
- [x] æœå°‹åŠŸèƒ½ç¨ç«‹æ¨¡çµ„ï¼ŒåŒ…å«å…ƒä»¶ã€çµ„åˆå¼å‡½å¼ã€å‹åˆ¥å®šç¾©ã€æ¸¬è©¦
- [x] å…±ç”¨ç¨‹å¼ç¢¼æ”¾ç½®æ–¼ `src/shared/`

### âœ… VII. Git Commit è¦ç¯„
- [x] éµå¾ª Conventional Commits v1.0.0
- [x] Commit æè¿°ä½¿ç”¨æ­£é«”ä¸­æ–‡

### âœ… VIII. HTTP è«‹æ±‚è¦ç¯„
- [x] æœ¬éšæ®µä½¿ç”¨ Mock è³‡æ–™ï¼Œæœªä¾†å°‡ä½¿ç”¨ Axios çµ±ä¸€ HTTP client
- [x] é ç•™ API ä»‹é¢è¨­è¨ˆï¼Œä¾¿æ–¼æœªä¾†æ•´åˆå¾Œç«¯

### âœ… IX. æ¨£å¼è¦ç¯„ (Tailwind CSS v4)
- [x] ä½¿ç”¨ Tailwind CSS v4 utility classes
- [x] é«˜äº®æ¨£å¼ï¼šbg-yellow-200 + font-boldï¼ˆé»ƒè‰²èƒŒæ™¯ + ç²—é«”ï¼‰
- [x] éŸ¿æ‡‰å¼è¨­è¨ˆä½¿ç”¨ Tailwind æ–·é»å‰ç¶´

### âœ… X. çµ„åˆå¼å‡½å¼è¦ç¯„ (VueUse)
- [x] ä½¿ç”¨ VueUse çš„ useDebounceFnï¼ˆ400ms é˜²æŠ–ï¼‰
- [x] å¯èƒ½ä½¿ç”¨ useLocalStorageï¼ˆå„²å­˜æœå°‹æ­·å²ï¼Œæœªä¾†æ“´å……ï¼‰
- [x] æŒ‰éœ€å¼•å…¥ï¼Œé¿å…å¼•å…¥æ•´å€‹å¥—ä»¶

### âœ… XI. å¿«å–ç­–ç•¥è¦ç¯„ (TanStack Query)
- [x] æœ¬éšæ®µä½¿ç”¨ Mock è³‡æ–™ï¼Œæœªä¾†å°‡æ•´åˆ TanStack Query
- [x] é ç•™ Query Key Factory è¨­è¨ˆ

### âœ… XII. API Contract è¦ç¯„ (ts-rest + Zod)
- [x] æœ¬éšæ®µå®šç¾© TypeScript å‹åˆ¥ä»‹é¢ï¼Œæœªä¾†å°‡ä½¿ç”¨ ts-rest + Zod
- [x] å‹åˆ¥å®šç¾©æ”¾ç½®æ–¼ `src/features/search/types/`

**è©•ä¼°çµæœ**ï¼šâœ… æ‰€æœ‰æ†²ç« æª¢æŸ¥é …ç›®çš†ç¬¦åˆï¼Œç„¡é•è¦éœ€è¦è¨˜éŒ„

## Project Structure

### Documentation (this feature)

```text
specs/004-lyrics-search/
â”œâ”€â”€ spec.md              # åŠŸèƒ½è¦æ ¼æ›¸ï¼ˆå·²å®Œæˆï¼‰
â”œâ”€â”€ plan.md              # æœ¬æ–‡ä»¶ï¼ˆå¯¦ä½œè¨ˆç•«ï¼‰
â”œâ”€â”€ research.md          # Phase 0 ç ”ç©¶ç”¢å‡º
â”œâ”€â”€ data-model.md        # Phase 1 è³‡æ–™æ¨¡å‹
â”œâ”€â”€ quickstart.md        # Phase 1 å¿«é€Ÿé–‹å§‹æŒ‡å—
â”œâ”€â”€ contracts/           # Phase 1 API å¥‘ç´„å®šç¾©
â”‚   â””â”€â”€ search.contract.ts
â””â”€â”€ checklists/          # å“è³ªæª¢æŸ¥æ¸…å–®
    â””â”€â”€ requirements.md  # å·²å®Œæˆ
```

### Source Code (repository root)

```text
src/
â”œâ”€â”€ features/
â”‚   â””â”€â”€ search/                    # æœå°‹åŠŸèƒ½æ¨¡çµ„
â”‚       â”œâ”€â”€ components/            # æœå°‹ç›¸é—œå…ƒä»¶
â”‚       â”‚   â”œâ”€â”€ SearchBar.vue      # æœå°‹è¼¸å…¥æ¡†å…ƒä»¶
â”‚       â”‚   â”œâ”€â”€ SearchResults.vue  # æœå°‹çµæœåˆ—è¡¨å…ƒä»¶
â”‚       â”‚   â”œâ”€â”€ SearchResultItem.vue  # å–®ä¸€æœå°‹çµæœé …ç›®å…ƒä»¶
â”‚       â”‚   â”œâ”€â”€ LyricsHighlight.vue   # æ­Œè©é«˜äº®é¡¯ç¤ºå…ƒä»¶
â”‚       â”‚   â”œâ”€â”€ Pagination.vue        # åˆ†é å…ƒä»¶
â”‚       â”‚   â””â”€â”€ LoadingSpinner.vue    # è¼‰å…¥æŒ‡ç¤ºå™¨å…ƒä»¶
â”‚       â”œâ”€â”€ composables/           # æœå°‹ç›¸é—œçµ„åˆå¼å‡½å¼
â”‚       â”‚   â”œâ”€â”€ useSearch.ts       # æœå°‹é‚è¼¯ï¼ˆé˜²æŠ–ã€åˆ†é ï¼‰
â”‚       â”‚   â””â”€â”€ useLyricsHighlight.ts  # æ­Œè©é«˜äº®é‚è¼¯
â”‚       â”œâ”€â”€ services/              # æœå°‹æœå‹™
â”‚       â”‚   â””â”€â”€ searchService.ts   # æœå°‹ API æœå‹™ï¼ˆç›®å‰ä½¿ç”¨ Mockï¼‰
â”‚       â”œâ”€â”€ types/                 # æœå°‹ç›¸é—œå‹åˆ¥å®šç¾©
â”‚       â”‚   â””â”€â”€ search.types.ts    # Song, SearchResultItem, SearchQuery
â”‚       â”œâ”€â”€ utils/                 # æœå°‹å·¥å…·å‡½å¼
â”‚       â”‚   â”œâ”€â”€ matchLyrics.ts     # æ­Œè©åŒ¹é…é‚è¼¯
â”‚       â”‚   â””â”€â”€ extractSnippet.ts  # æ­Œè©ç‰‡æ®µæ“·å–é‚è¼¯
â”‚       â”œâ”€â”€ __tests__/             # æœå°‹åŠŸèƒ½å–®å…ƒæ¸¬è©¦
â”‚       â”‚   â”œâ”€â”€ useSearch.test.ts
â”‚       â”‚   â”œâ”€â”€ useLyricsHighlight.test.ts
â”‚       â”‚   â”œâ”€â”€ matchLyrics.test.ts
â”‚       â”‚   â””â”€â”€ extractSnippet.test.ts
â”‚       â”œâ”€â”€ views/                 # æœå°‹é é¢
â”‚       â”‚   â””â”€â”€ SearchPage.vue     # æœå°‹ä¸»é é¢
â”‚       â””â”€â”€ index.ts               # åŠŸèƒ½æ¨¡çµ„å…¥å£
â”œâ”€â”€ shared/                        # å…±ç”¨ç¨‹å¼ç¢¼
â”‚   â”œâ”€â”€ components/                # å…±ç”¨å…ƒä»¶
â”‚   â”‚   â””â”€â”€ EmptyState.vue         # ç©ºç‹€æ…‹å…ƒä»¶ï¼ˆæŸ¥ç„¡çµæœï¼‰
â”‚   â”œâ”€â”€ composables/               # å…±ç”¨çµ„åˆå¼å‡½å¼
â”‚   â”œâ”€â”€ utils/                     # å·¥å…·å‡½å¼
â”‚   â”‚   â””â”€â”€ validation.ts          # è¼¸å…¥é©—è­‰ï¼ˆç©ºç™½ã€è¶…é•·å­—ä¸²ï¼‰
â”‚   â””â”€â”€ types/                     # å…±ç”¨å‹åˆ¥å®šç¾©
â”‚       â””â”€â”€ common.types.ts
â”œâ”€â”€ router/                        # è·¯ç”±è¨­å®š
â”‚   â””â”€â”€ index.ts                   # Vue Router è¨­å®š
â”œâ”€â”€ App.vue                        # æ ¹å…ƒä»¶
â”œâ”€â”€ main.ts                        # æ‡‰ç”¨ç¨‹å¼å…¥å£
â””â”€â”€ style.css                      # å…¨åŸŸæ¨£å¼ï¼ˆTailwind CSS v4ï¼‰

e2e/
â””â”€â”€ search.spec.ts                 # æœå°‹åŠŸèƒ½ E2E æ¸¬è©¦ï¼ˆPlaywrightï¼‰

tests/                             # é¡å¤–æ¸¬è©¦è¨­å®š
â””â”€â”€ setup.ts                       # Vitest æ¸¬è©¦è¨­å®š
```

**Structure Decision**: æ¡ç”¨ Feature-Based æ¶æ§‹ï¼Œæœå°‹åŠŸèƒ½ä½œç‚ºç¨ç«‹æ¨¡çµ„ä½æ–¼ `src/features/search/`ã€‚æ­¤çµæ§‹ç¬¦åˆæ†²ç«  VI. Feature-Based æ¶æ§‹è¦ç¯„ï¼Œç¢ºä¿åŠŸèƒ½æ¨¡çµ„åŒ–ã€å¯æ¸¬è©¦æ€§å’Œå¯ç¶­è­·æ€§ã€‚æœ¬éšæ®µå°ˆæ³¨æ–¼å‰ç«¯æœå°‹åŠŸèƒ½ï¼Œæš«ä¸å»ºç«‹å¾Œç«¯çµæ§‹ã€‚

## Complexity Tracking

> **æœ¬åŠŸèƒ½ç„¡æ†²ç« é•è¦ï¼Œæ­¤å€æ®µä¸é©ç”¨**
